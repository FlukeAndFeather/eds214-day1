---
title: "EDS 214 Final Project"
author: Ava Robillard
format: html
---

## Background

Stream water concentrations can be affected by watershed disturbances like hurricanes, which can be studied using long-term weekly records of stream water chemistry in the Luquillo Mountains of Puerto Rico before and after Hurricane Hugo in 1989.

Four watersheds, Puente Roto Mameyes (PRM) and Bisley Quebradas 1, 2, and 3 (BQ1, BQ2, and BQ3) are sites located within the Luquillo Experimental Forest (LEF).

This paper serves to recreate Figure 3 of the study in Schaefer et al. (2000), which represents 9-week moving averages of concentrations of various nutrients before and after the hurricane in each of the four watersheds.

### Set up
```{r}
#| warning: false
#| message: false
# Load packages
library(here)
library(tidyverse)
library(dplyr)
library(janitor)
library(patchwork)

# Source functions
source(here("R", "moving_average.R"))
```

## Data

### Read in cleaned data
```{r}
#| message: false
filtered_df <- read_csv(here("output", "filtered_df.csv"))
```

## Methods

The nine-week moving average was calculated for each nutrient and each site, and added as a column to a final data frame to be used for plotting.

## Results
The final figure is reflects each nutrient's rolling average from 1988-1995, with line type based upon site.
### Patchwork figure
```{r}
#| warning: false
final_df <- read_csv(here("output", "final_df.csv"))
# Create ggplot for each nutrient

# Create k graph
figurek <- ggplot(final_df, aes(x = sample_date, y = calc_rolling_k)) +
  geom_line(aes(linetype = sample_id)) +
  labs(x = "Year",
       y = "K mg/l")

# Save output
ggsave(here("output", "figurek.png"))

# Create no3_n graph
figureno3_n <- ggplot(final_df, aes(x = sample_date, y = calc_rolling_no3_n)) +
  geom_line(aes(linetype = sample_id)) +
  labs(x = "Year",
       y = "NO3-N ug/l")

# Save output
ggsave(here("output", "figureno3_n.png"))

# Create mg graph
figuremg <- ggplot(final_df, aes(x = sample_date, y = calc_rolling_mg)) +
  geom_line(aes(linetype = sample_id)) +
  labs(x = "Year",
       y = "Mg mg/l")

# Save output
ggsave(here("output", "figuremg.png"))

# Create ca graph
figureca <- ggplot(final_df, aes(x = sample_date, y = calc_rolling_ca)) +
  geom_line(aes(linetype = sample_id))  +
  labs(x = "Year",
       y = "Ca mg/l")

# Save output
ggsave(here("output", "figureca.png"))

# Create nh4_n graph
figurenh4_n <- ggplot(final_df, aes(x = sample_date, y = calc_rolling_nh4_n)) +
  geom_line(aes(linetype = sample_id)) +
  labs(x = "Year",
       y = "NH4-N ug/l") 

# Save output
ggsave(here("output", "figurenh4_n.png"))

# Combine figures into a patchwork figure
patchwork <- (figurek/figureno3_n/figuremg/figureca/figurenh4_n) +
  plot_layout(axes = "collect", guides = "collect")
patchwork & theme_light() +
  theme(
    legend.title = element_text("Site")
  ) 

# Save output
ggsave(here("output", "patchwork.png"))
```
```
![Final Figure]("output/patchwork.png")

