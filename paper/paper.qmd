---
title: "EDS 214 Final Project"
author: Ava Robillard
format: html
---

## Background

Stream water concentrations can be affected by watershed disturbances like hurricanes, which can be studied using long-term weekly records of stream water chemistry in the Luquillo Mountains of Puerto Rico before and after Hurricane Hugo in 1989.

Four watersheds, Puente Roto Mameyes (PRM) and Bisley Quebradas 1, 2, and 3 (BQ1, BQ2, and BQ3) are sites located within the Luquillo Experimental Forest (LEF).

This paper serves to recreate Figure 3 of the study in Schaefer et al. (2000), which represents 9-week moving averages of concentrations of various nutrients before and after the hurricane in each of the four watersheds.

### Set up
```{r}
#| message: false
library(tidyverse)
library(here)
library(kableExtra)
```


## Data

The raw data file for each of the four watersheds was read in and joined into one data frame with cleaned column names. The data was then filtered to only contain dates from 1988-1995 and the necessary columns for analysis: sample_id, sample_date and the four nutrients. 

These are the first six rows of the cleaned data frame:
```{r}
#| echo: false
#| message: false
# visualization of data frame
filtered_df <- read_csv(here("output", "filtered_df.csv"))
df_head <- head(filtered_df) %>% 
  kbl() %>% 
  kable_styling()

df_head
```


## Methods

The nine-week moving average was calculated for each nutrient and each site, and added as a column to a final data frame to be used for plotting. The moving average needed a separate function due to missing data in some weeks. This was done by creating a function called moving_average, which takes parameters focal date, dates, concentration, and window size (weeks) and returns the mean nutrient concentration for the specified date and window size. 

This function was then applied to the clean data frame (grouped by site) and a column was added to the data frame for each nutrient's rolling average.

## Results

The final figure is reflects each nutrient's rolling average from 1988-1995, with line type based upon site. This was created using the patchwork library with an individual plot made for each nutrient. 

![](images/patchwork.png)